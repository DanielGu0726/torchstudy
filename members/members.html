<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Members â€“ TORCH</title>
  <link rel="stylesheet" href="../css/style.css">
  <style>
    /* Card: horizontal â€“ photo left, info right */
    .member-row-card { display: grid; grid-template-columns: 264px 1fr; gap: 32px; align-items: start; background: var(--white); border-radius: var(--radius-lg); padding: 28px; box-shadow: var(--shadow); border: 1.5px solid var(--border); margin-bottom: 16px; transition: border-color .2s, box-shadow .2s; }
    .member-row-card.has-artwork { cursor: pointer; }
    .member-row-card.has-artwork:hover { border-color: var(--primary); box-shadow: 0 6px 28px rgba(0,0,0,.12); }
    .member-row-card:not(.has-artwork):hover { border-color: var(--primary); }

    /* Avatar: 264px (3Ã— original 88px) */
    .member-avatar-lg { width: 264px; height: 264px; border-radius: 50%; overflow: hidden; background: var(--primary); display: flex; align-items: center; justify-content: center; font-size: 5rem; font-weight: 700; color: #fff; flex-shrink: 0; }
    .member-avatar-lg img { width: 100%; height: 100%; object-fit: cover; }

    /* Info block */
    .member-card-info { min-width: 0; }
    .member-info-name { font-size: 1.15rem; font-weight: 700; margin-bottom: 4px; }
    .member-info-title { font-size: .85rem; color: var(--primary); font-weight: 600; margin-bottom: 6px; }
    .member-info-workplace { font-size: .88rem; color: var(--text-muted); margin-bottom: 10px; }

    /* Bio: preserve newlines & spaces exactly as entered */
    .member-info-bio { font-size: .88rem; color: var(--text-muted); line-height: 1.75; white-space: pre-line; margin-top: 10px; padding-top: 10px; border-top: 1px solid var(--border); }

    /* Artwork hint badge (shows on cards that have artwork) */
    .artwork-hint { display: inline-flex; align-items: center; gap: 5px; margin-top: 14px; font-size: .78rem; color: var(--primary); font-weight: 600; opacity: .75; }

    /* Sort bar */
    .sort-bar { display: flex; align-items: center; gap: 10px; margin-bottom: 24px; flex-wrap: wrap; }
    .sort-bar label { font-size: .85rem; color: var(--text-muted); font-weight: 500; }
    .sort-bar select { padding: 6px 12px; border: 1px solid var(--border); border-radius: 6px; font-size: .85rem; background: var(--white); color: var(--text); }

    /* Mobile: stack vertically */
    @media(max-width:640px) {
      .member-row-card { grid-template-columns: 1fr; justify-items: center; }
      .member-avatar-lg { width: 180px; height: 180px; font-size: 3.5rem; }
      .member-card-info { width: 100%; }
    }

    /* â”€â”€ Lightbox â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #artwork-lightbox { display: none; position: fixed; inset: 0; background: rgba(0,0,0,.93); z-index: 9999; align-items: center; justify-content: center; cursor: zoom-out; }
    #artwork-lightbox.open { display: flex; }
    #artwork-lightbox img { max-width: 95vw; max-height: 92vh; object-fit: contain; border-radius: 6px; box-shadow: 0 8px 48px rgba(0,0,0,.6); pointer-events: none; }
    #lightbox-close { position: absolute; top: 20px; right: 28px; color: #fff; font-size: 2.4rem; line-height: 1; cursor: pointer; background: none; border: none; padding: 0; opacity: .8; transition: opacity .15s; }
    #lightbox-close:hover { opacity: 1; }
  </style>
</head>
<body>
<nav class="navbar">
  <div class="nav-inner">
    <a href="../index.html" class="nav-logo"><div class="logo-icon">ğŸ”¥</div>TORCH</a>
    <div class="nav-links">
      <div class="nav-item"><a href="../index.html" class="nav-link">Home</a></div>
      <div class="nav-item"><a href="../about.html" class="nav-link">About</a></div>
      <div class="nav-item"><a href="../activity/index.html" class="nav-link">Activity</a></div>
      <div class="nav-item"><span class="nav-link">Registration <svg viewBox="0 0 10 6" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M1 1l4 4 4-4"/></svg></span><div class="dropdown"><a href="../registration/study.html">Study Group</a><a href="../registration/symposium.html">Symposium</a><a href="../registration/workshop.html">Workshop</a></div></div>
      <div class="nav-item"><a href="../sponsor.html" class="nav-link">Sponsor</a></div>
      <div class="nav-item"><a href="members.html" class="nav-link active">Members</a></div>
      <div class="nav-item"><a href="../news/index.html" class="nav-link">News</a></div>
      <div class="nav-item"><a href="../contact.html" class="nav-link">Contact</a></div>
    </div>
    <div class="hamburger"><span></span><span></span><span></span></div>
  </div>
</nav>
<div class="mobile-menu">
  <a href="../index.html" class="mobile-link">Home</a>
  <a href="../about.html" class="mobile-link">About</a>
  <a href="members.html" class="mobile-link">Members ì†Œê°œ</a>
  <a href="../contact.html" class="mobile-link">Contact</a>
</div>

<div class="page-header">
  <div class="container">
    <span class="eyebrow">Community</span>
    <h1>TORCH Members</h1>
    <p>TORCHë¥¼ í•¨ê»˜ ë§Œë“¤ì–´ê°€ëŠ” ì‚¬ëŒë“¤ì„ ì†Œê°œí•©ë‹ˆë‹¤.</p>
    <div class="breadcrumb"><a href="../index.html">Home</a><span>/</span><span>Members</span></div>
  </div>
</div>

<section class="section section-light">
  <div class="container">

    <!-- Tabs -->
    <div class="tabs">
      <button class="tab-btn active" data-tab="president">ğŸ”¥ íšŒì¥ ì¸ì‚¬ë§</button>
      <button class="tab-btn" data-tab="alumni">ğŸ“š ì—­ëŒ€ Members</button>
      <button class="tab-btn" data-tab="current">ğŸ‘¥ 2026 TORCH Members</button>
    </div>

    <!-- â”€â”€ Tab 1: íšŒì¥ ì¸ì‚¬ë§ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div id="tab-president" class="tab-pane active">
      <div class="president-section">
        <div style="text-align:center">
          <div class="president-photo" id="president-photo">ğŸ”¥</div>
          <div style="margin-top:18px">
            <div style="font-size:1.05rem;font-weight:700" id="president-name">â€”</div>
            <div style="font-size:.85rem;color:var(--text-muted);margin-top:2px" id="president-title-display">â€”</div>
          </div>
        </div>
        <div>
          <div class="quote-mark">"</div>
          <p class="greeting-text" id="president-bio-display" style="white-space:pre-line">
            ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦
          </p>
          <div style="margin-top:28px;padding-top:20px;border-top:1px solid var(--border);font-size:.9rem;color:var(--text-muted)">
            <span id="president-title-sign">â€”</span> <strong style="color:var(--text)" id="president-sign">â€”</strong>
          </div>
        </div>
      </div>
    </div>

    <!-- â”€â”€ Tab 2: ì—­ëŒ€ Members â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div id="tab-alumni" class="tab-pane">
      <!-- Sort bar -->
      <div class="sort-bar">
        <label>ì •ë ¬:</label>
        <select id="alumni-sort" onchange="renderAlumni()">
          <option value="year-desc">ì—°ë„ (ìµœì‹ ìˆœ)</option>
          <option value="year-asc">ì—°ë„ (ì˜¤ë˜ëœìˆœ)</option>
          <option value="name-asc">ì´ë¦„ (ê°€ë‚˜ë‹¤ìˆœ)</option>
          <option value="workplace-asc">ì†Œì† (ê°€ë‚˜ë‹¤ìˆœ)</option>
        </select>
      </div>
      <div id="alumni-list">
        <div style="text-align:center;padding:60px;color:var(--text-muted)">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>
      </div>
    </div>

    <!-- â”€â”€ Tab 3: 2026 TORCH Members â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div id="tab-current" class="tab-pane">
      <div id="current-list">
        <div style="text-align:center;padding:60px;color:var(--text-muted)">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>
      </div>
    </div>

  </div>
</section>

<!-- â”€â”€ Artwork Lightbox â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="artwork-lightbox" onclick="closeLightbox()">
  <button id="lightbox-close" onclick="closeLightbox()" aria-label="ë‹«ê¸°">âœ•</button>
  <img id="lightbox-img" src="" alt="Artwork">
</div>

<footer class="footer">
  <div class="container">
    <div class="footer-grid">
      <div class="footer-brand">
        <a href="../index.html" class="nav-logo"><div class="logo-icon">ğŸ”¥</div>TORCH</a>
        <p style="margin-top:12px">Korea Young Dental Technician Study<br>ê¸°ìˆ  Â· ê¸°íšŒ Â· ë³´ì™„ Â· ë„ì „ Â· í¬ë§</p>
        <div style="margin-top:16px"><a href="https://www.instagram.com/t_o_r_c_h_study/" target="_blank" class="btn btn-sm" style="background:rgba(255,255,255,.08);color:rgba(255,255,255,.7);border:1px solid rgba(255,255,255,.15)">ğŸ“· @t_o_r_c_h_study</a></div>
      </div>
      <div class="footer-col"><h4>Pages</h4><ul><li><a href="../about.html">About</a></li><li><a href="../activity/index.html">Activity</a></li><li><a href="../sponsor.html">Sponsor</a></li></ul></div>
      <div class="footer-col"><h4>Registration</h4><ul><li><a href="../registration/study.html">Study Group</a></li><li><a href="../registration/symposium.html">Symposium</a></li><li><a href="../registration/workshop.html">Workshop</a></li></ul></div>
      <div class="footer-col"><h4>Community</h4><ul><li><a href="../news/index.html">News</a></li><li><a href="members.html">Members</a></li><li><a href="../contact.html">Contact</a></li></ul></div>
    </div>
    <div class="footer-bottom">
      <span>Â© 2025 TORCH â€“ Korea Young Dental Technician Study. All rights reserved.</span>
      <div class="social-links">
        <a href="https://www.instagram.com/t_o_r_c_h_study/" target="_blank" class="social-link" title="Instagram">ğŸ“·</a>
      </div>
    </div>
  </div>
</footer>

<script src="../js/theme.js"></script>
<script>
/* â”€â”€ Tab switching â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let alumniLoaded = false, currentLoaded = false;

document.querySelectorAll('.tab-btn').forEach(btn => {
  btn.addEventListener('click', function() {
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
    this.classList.add('active');
    document.getElementById('tab-' + this.dataset.tab).classList.add('active');

    if (this.dataset.tab === 'alumni' && !alumniLoaded) {
      loadAllMembers();
      alumniLoaded = true;
    }
    if (this.dataset.tab === 'current' && !currentLoaded) {
      loadCurrentMembers();
      currentLoaded = true;
    }
  });
});

/* â”€â”€ Escape HTML â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function esc(str) {
  return (str || '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

/* â”€â”€ President â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function loadPresident() {
  try {
    const res = await fetch('/api/president');
    if (!res.ok) throw new Error();
    const p = await res.json();

    // Photo
    const photoEl = document.getElementById('president-photo');
    if (p.photo) {
      photoEl.innerHTML = `<img src="${esc(p.photo)}" alt="${esc(p.name)}" style="width:100%;height:100%;object-fit:cover;border-radius:50%">`;
    }

    // Name & title
    document.getElementById('president-name').textContent = p.name || 'â€”';
    document.getElementById('president-title-display').textContent = p.title || 'â€”';
    document.getElementById('president-sign').textContent = p.name || 'â€”';
    document.getElementById('president-title-sign').textContent = p.title || 'â€”';

    // Bio (greeting)
    const bioEl = document.getElementById('president-bio-display');
    if (p.bio) {
      bioEl.textContent = p.bio;
    } else {
      bioEl.innerHTML = `ì•ˆë…•í•˜ì„¸ìš”, TORCH íšŒì› ì—¬ëŸ¬ë¶„.<br><br>
ì €ëŠ” TORCHê°€ ë‹¨ìˆœí•œ ìŠ¤í„°ë”” ê·¸ë£¹ì´ ì•„ë‹ˆë¼, ëŒ€í•œë¯¼êµ­ ì¹˜ê¸°ê³µ ì—…ê³„ì˜ ë¯¸ë˜ë¥¼ í•¨ê»˜ ë§Œë“¤ì–´ê°€ëŠ” ê³µë™ì²´ë¼ê³  ë¯¿ìŠµë‹ˆë‹¤.<br><br>
TORCHëŠ” <strong>T</strong>echnology(ê¸°ìˆ ), <strong>O</strong>pportunity(ê¸°íšŒ), <strong>R</strong>edeem(ë³´ì™„), <strong>C</strong>hallenge(ë„ì „), <strong>H</strong>ope(í¬ë§) â€” ì´ ë‹¤ì„¯ ê°€ì§€ ê°€ì¹˜ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ëª¨ì¸ ì Šì€ ì¹˜ê¸°ê³µì‚¬ë“¤ì˜ ëª¨ì„ì…ë‹ˆë‹¤.<br><br>
ì—¬ëŸ¬ë¶„ì˜ ì°¸ì—¬ì™€ ì—´ì •ì´ TORCHë¥¼ ë”ìš± ë¹›ë‚˜ê²Œ í•©ë‹ˆë‹¤. í•¨ê»˜í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.`;
    }
  } catch {
    // keep default fallback text
  }
}

/* â”€â”€ All members (ì—­ëŒ€ â€“ includes 2026 current) â”€â”€ */
let allMembersData = [];

async function loadAllMembers() {
  const container = document.getElementById('alumni-list');
  try {
    const res = await fetch('/api/members-list');  // no category filter â†’ all members
    if (!res.ok) throw new Error();
    const { members } = await res.json();
    allMembersData = members || [];
    renderAlumni();
  } catch {
    container.innerHTML = `<div style="text-align:center;padding:60px;color:var(--text-muted)">
      <div style="font-size:3rem;margin-bottom:16px">ğŸ“š</div>
      <p>ì—­ëŒ€ íšŒì› ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
    </div>`;
  }
}

function renderAlumni() {
  const container = document.getElementById('alumni-list');
  if (!allMembersData.length) {
    container.innerHTML = `<div style="text-align:center;padding:60px;color:var(--text-muted)">
      <div style="font-size:3rem;margin-bottom:16px">ğŸ“š</div><p>ë“±ë¡ëœ íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤.</p></div>`;
    return;
  }

  const sortKey = document.getElementById('alumni-sort').value;
  let sorted = [...allMembersData];

  if (sortKey === 'year-desc') {
    sorted.sort((a, b) => (b.year || 0) - (a.year || 0) || (a.order_num || 0) - (b.order_num || 0));
  } else if (sortKey === 'year-asc') {
    sorted.sort((a, b) => (a.year || 0) - (b.year || 0) || (a.order_num || 0) - (b.order_num || 0));
  } else if (sortKey === 'name-asc') {
    sorted.sort((a, b) => (a.name || '').localeCompare(b.name || '', 'ko'));
  } else if (sortKey === 'workplace-asc') {
    sorted.sort((a, b) => (a.workplace || '').localeCompare(b.workplace || '', 'ko'));
  }

  // Group by year
  const byYear = {};
  sorted.forEach(m => {
    const y = m.year || 'ê¸°íƒ€';
    if (!byYear[y]) byYear[y] = [];
    byYear[y].push(m);
  });

  // Year order depends on sort
  let years = Object.keys(byYear);
  if (sortKey === 'year-asc') {
    years.sort((a, b) => Number(a) - Number(b));
  } else if (sortKey === 'year-desc') {
    years.sort((a, b) => Number(b) - Number(a));
  }
  // For name/workplace sort, keep insertion order (already sorted above)

  container.innerHTML = years.map(y => `
    <div class="year-group">
      <div class="year-label">${esc(y)} Members</div>
      ${byYear[y].map(m => buildMemberCard(m)).join('')}
    </div>
  `).join('');
}

/* â”€â”€ 2026 current members â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function loadCurrentMembers() {
  const container = document.getElementById('current-list');
  try {
    const res = await fetch('/api/members-list?category=current');
    if (!res.ok) throw new Error();
    const { members } = await res.json();

    if (!members || !members.length) {
      container.innerHTML = `<div style="text-align:center;padding:60px;color:var(--text-muted)">
        <div style="font-size:3rem;margin-bottom:16px">ğŸ‘¥</div>
        <p>2026 íšŒì› ì†Œê°œë¥¼ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.</p>
        <p style="font-size:.88rem">ë¬¸ì˜: <a href="../contact.html">contact í˜ì´ì§€</a> ë˜ëŠ” <a href="https://www.instagram.com/t_o_r_c_h_study/" target="_blank">Instagram</a></p>
      </div>`;
      return;
    }
    container.innerHTML = members.map(m => buildMemberCard(m)).join('');
  } catch {
    container.innerHTML = `<div style="text-align:center;padding:60px;color:var(--text-muted)">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>`;
  }
}

/* â”€â”€ Build member card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
// Artwork stored by card index to avoid base64-in-onclick issues
const _artworkStore = {};
let _cardIdx = 0;

function buildMemberCard(m) {
  const initial = (m.name || '?').replace(/\s/g, '')[0] || '?';
  const avatar = m.photo
    ? `<img src="${esc(m.photo)}" alt="${esc(m.name)}">`
    : initial;

  const webpage = m.webpage
    ? `<div style="margin-top:14px"><a href="${esc(m.webpage)}" target="_blank" rel="noopener" class="btn btn-sm btn-dark" style="font-size:.78rem;padding:5px 12px" onclick="event.stopPropagation()">ğŸŒ ì›¹ì‚¬ì´íŠ¸</a></div>`
    : '';

  // Artwork: hidden from card; card click opens lightbox
  let cardAttrs = '';
  let artworkHint = '';
  if (m.artwork) {
    const idx = _cardIdx++;
    _artworkStore[idx] = m.artwork;
    cardAttrs = `class="member-row-card has-artwork" onclick="openLightbox(_artworkStore[${idx}])"`;
    artworkHint = `<div class="artwork-hint">ğŸ–¼ Artwork ë³´ê¸°</div>`;
  } else {
    cardAttrs = `class="member-row-card"`;
  }

  return `
    <div ${cardAttrs}>
      <div class="member-avatar-lg">${avatar}</div>
      <div class="member-card-info">
        <div class="member-info-name">${esc(m.name)}</div>
        ${m.title    ? `<div class="member-info-title">${esc(m.title)}</div>` : ''}
        ${m.workplace? `<div class="member-info-workplace">ğŸ“ ${esc(m.workplace)}</div>` : ''}
        ${m.bio      ? `<div class="member-info-bio">${esc(m.bio)}</div>` : ''}
        ${artworkHint}
        ${webpage}
      </div>
    </div>`;
}

/* â”€â”€ Lightbox â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function openLightbox(src) {
  document.getElementById('lightbox-img').src = src;
  document.getElementById('artwork-lightbox').classList.add('open');
  document.body.style.overflow = 'hidden';
}
function closeLightbox() {
  document.getElementById('artwork-lightbox').classList.remove('open');
  document.getElementById('lightbox-img').src = '';
  document.body.style.overflow = '';
}
document.addEventListener('keydown', e => { if (e.key === 'Escape') closeLightbox(); });

/* â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
loadPresident();
</script>
</body>
</html>
