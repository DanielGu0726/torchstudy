<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Members â€“ TORCH</title>
  <link rel="stylesheet" href="../css/style.css">
  <style>
    /* Card: horizontal â€“ photo left, info right */
    .member-row-card { display: grid; grid-template-columns: 264px 1fr; gap: 32px; align-items: start; background: var(--white); border-radius: var(--radius-lg); padding: 28px; box-shadow: var(--shadow); border: 1.5px solid var(--border); margin-bottom: 16px; transition: border-color .2s, box-shadow .2s; }
    .member-row-card.has-artwork { cursor: pointer; }
    .member-row-card.has-artwork:hover { border-color: var(--primary); box-shadow: 0 6px 28px rgba(0,0,0,.12); }
    .member-row-card:not(.has-artwork):hover { border-color: var(--primary); }

    /* Avatar: 264px (3Ã— original 88px) */
    .member-avatar-lg { width: 264px; height: 264px; border-radius: 50%; overflow: hidden; background: var(--primary); display: flex; align-items: center; justify-content: center; font-size: 5rem; font-weight: 700; color: #fff; flex-shrink: 0; }
    .member-avatar-lg img { width: 100%; height: 100%; object-fit: cover; }

    /* Info block */
    .member-card-info { min-width: 0; }
    .member-info-name { font-size: 1.15rem; font-weight: 700; margin-bottom: 4px; }
    .member-info-title { font-size: .85rem; color: var(--primary); font-weight: 600; margin-bottom: 6px; }
    .member-info-workplace { font-size: .88rem; color: var(--text-muted); margin-bottom: 10px; }

    /* Bio: preserve newlines & spaces exactly as entered */
    .member-info-bio { font-size: .88rem; color: var(--text-muted); line-height: 1.75; white-space: pre-line; margin-top: 10px; padding-top: 10px; border-top: 1px solid var(--border); }

    /* Artwork hint badge (shows on cards that have artwork) */
    .artwork-hint { display: inline-flex; align-items: center; gap: 5px; margin-top: 14px; font-size: .78rem; color: var(--primary); font-weight: 600; opacity: .75; }

    /* Sort bar */
    .sort-bar { display: flex; align-items: center; gap: 10px; margin-bottom: 24px; flex-wrap: wrap; }
    .sort-bar label { font-size: .85rem; color: var(--text-muted); font-weight: 500; }
    .sort-bar select { padding: 6px 12px; border: 1px solid var(--border); border-radius: 6px; font-size: .85rem; background: var(--white); color: var(--text); }

    /* Mobile: stack vertically */
    @media(max-width:640px) {
      .member-row-card { grid-template-columns: 1fr; justify-items: center; }
      .member-avatar-lg { width: 180px; height: 180px; font-size: 3.5rem; }
      .member-card-info { width: 100%; }
    }

    /* â”€â”€ Lightbox â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #artwork-lightbox { display: none; position: fixed; inset: 0; background: rgba(0,0,0,.93); z-index: 9999; align-items: center; justify-content: center; }
    #artwork-lightbox.open { display: flex; }
    #artwork-lightbox img { max-width: 90vw; max-height: 88vh; object-fit: contain; border-radius: 6px; box-shadow: 0 8px 48px rgba(0,0,0,.6); pointer-events: none; display: block; }
    #lightbox-close { position: absolute; top: 20px; right: 28px; color: #fff; font-size: 2.4rem; line-height: 1; cursor: pointer; background: none; border: none; padding: 0; opacity: .8; transition: opacity .15s; }
    #lightbox-close:hover { opacity: 1; }
    .lightbox-nav { position: absolute; top: 50%; transform: translateY(-50%); background: rgba(255,255,255,.15); color: #fff; border: none; border-radius: 50%; width: 48px; height: 48px; font-size: 1.6rem; cursor: pointer; transition: background .15s; display: none; align-items: center; justify-content: center; }
    .lightbox-nav:hover { background: rgba(255,255,255,.3); }
    #lightbox-prev { left: 20px; }
    #lightbox-next { right: 20px; }
    #lightbox-counter { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); color: rgba(255,255,255,.8); font-size: .88rem; font-weight: 600; display: none; background: rgba(0,0,0,.4); padding: 4px 12px; border-radius: 20px; }
  </style>
</head>
<body>
<nav class="navbar">
  <div class="nav-inner">
    <a href="../index.html" class="nav-logo"><div class="logo-icon">ğŸ”¥</div>TORCH</a>
    <div class="nav-links">
      <div class="nav-item"><a href="../index.html" class="nav-link">Home</a></div>
      <div class="nav-item"><a href="../about.html" class="nav-link">About</a></div>
      <div class="nav-item"><a href="../activity/index.html" class="nav-link">Activity</a></div>
      <div class="nav-item"><span class="nav-link">Registration <svg viewBox="0 0 10 6" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M1 1l4 4 4-4"/></svg></span><div class="dropdown"><a href="../registration/study.html">Study Group</a><a href="../registration/symposium.html">Symposium</a><a href="../registration/workshop.html">Workshop</a></div></div>
      <div class="nav-item"><a href="../sponsor.html" class="nav-link">Sponsor</a></div>
      <div class="nav-item"><a href="members.html" class="nav-link active">Members</a></div>
      <div class="nav-item"><a href="../news/index.html" class="nav-link">News</a></div>
      <div class="nav-item"><a href="../contact.html" class="nav-link">Contact</a></div>
    </div>
    <div class="lang-toggle">
      <button class="lang-btn active" id="btn-ko" onclick="I18n.setLang('ko')">KOR</button>
      <button class="lang-btn" id="btn-en" onclick="I18n.setLang('en')">ENG</button>
    </div>
    <div class="hamburger"><span></span><span></span><span></span></div>
  </div>
</nav>
<div class="mobile-menu">
  <a href="../index.html" class="mobile-link">Home</a>
  <a href="../about.html" class="mobile-link">About</a>
  <a href="../activity/index.html" class="mobile-link">Activity</a>
  <div class="mobile-dropdown">
    <div class="mobile-dropdown-toggle">
      <span>Registration</span>
      <svg viewBox="0 0 10 6" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M1 1l4 4 4-4"/></svg>
    </div>
    <div class="mobile-submenu">
      <a href="../registration/study.html" class="mobile-link" data-i18n="mobile.study">Study ì‹ ì²­</a>
      <a href="../registration/symposium.html" class="mobile-link">Symposium</a>
      <a href="../registration/workshop.html" class="mobile-link" data-i18n="mobile.workshop">Workshop ì‹ ì²­</a>
    </div>
  </div>
  <a href="../sponsor.html" class="mobile-link">Sponsor</a>
  <a href="members.html" class="mobile-link" data-i18n="mobile.members">Members ì†Œê°œ</a>
  <a href="../news/index.html" class="mobile-link">News</a>
  <a href="../contact.html" class="mobile-link">Contact</a>

  <!-- Mobile Toggles -->
  <div class="mobile-toggles">
    <div class="mobile-toggle-row">
      <span class="mobile-toggle-label">Dark Mode</span>
      <div class="mobile-theme-toggle" onclick="Theme.toggle()">
        <span class="toggle-knob"></span>
      </div>
    </div>
    <div class="mobile-toggle-row">
      <span class="mobile-toggle-label">Language</span>
      <div class="mobile-lang-toggle">
        <button class="mobile-lang-btn active" id="mobile-btn-ko" onclick="I18n.setLang('ko')">KOR</button>
        <button class="mobile-lang-btn" id="mobile-btn-en" onclick="I18n.setLang('en')">ENG</button>
      </div>
    </div>
  </div>
</div>

<div class="page-header">
  <div class="container">
    <span class="eyebrow">Community</span>
    <h1>TORCH Members</h1>
    <p data-i18n="members.header.p">TORCHë¥¼ í•¨ê»˜ ë§Œë“¤ì–´ê°€ëŠ” ì‚¬ëŒë“¤ì„ ì†Œê°œí•©ë‹ˆë‹¤.</p>
    <div class="breadcrumb"><a href="../index.html">Home</a><span>/</span><span>Members</span></div>
  </div>
</div>

<section class="section section-light">
  <div class="container">

    <!-- Tabs -->
    <div class="tabs">
      <button class="tab-btn active" data-tab="president" data-i18n="members.tab.president">ğŸ”¥ íšŒì¥ ì¸ì‚¬ë§</button>
      <button class="tab-btn" data-tab="past-presidents" data-i18n="members.tab.past-presidents">ğŸ‘‘ ì—­ëŒ€ íšŒì¥</button>
      <button class="tab-btn" data-tab="alumni" data-i18n="members.tab.alumni">ğŸ“š ì—­ëŒ€ Members</button>
      <button class="tab-btn" data-tab="current" data-i18n="members.tab.current">ğŸ‘¥ 2026 TORCH Members</button>
    </div>

    <!-- â”€â”€ Tab 1: íšŒì¥ ì¸ì‚¬ë§ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div id="tab-president" class="tab-pane active">
      <div class="president-section">
        <div style="text-align:center">
          <div class="president-photo" id="president-photo">ğŸ”¥</div>
          <div style="margin-top:18px">
            <div style="font-size:1.05rem;font-weight:700" id="president-name">â€”</div>
            <div style="font-size:.85rem;color:var(--text-muted);margin-top:2px" id="president-title-display">â€”</div>
          </div>
        </div>
        <div>
          <div class="quote-mark">"</div>
          <p class="greeting-text" id="president-bio-display" style="white-space:pre-line">
            ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦
          </p>
          <div style="margin-top:28px;padding-top:20px;border-top:1px solid var(--border);font-size:.9rem;color:var(--text-muted)">
            <span id="president-title-sign">â€”</span> <strong style="color:var(--text)" id="president-sign">â€”</strong>
          </div>
        </div>
      </div>
    </div>

    <!-- â”€â”€ Tab 2: ì—­ëŒ€ íšŒì¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div id="tab-past-presidents" class="tab-pane">
      <div id="past-presidents-list" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:24px">
        <div style="text-align:center;padding:60px;color:var(--text-muted);grid-column:1/-1" data-i18n="common.loading">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>
      </div>
    </div>

    <!-- â”€â”€ Tab 3: ì—­ëŒ€ Members â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div id="tab-alumni" class="tab-pane">
      <!-- Sort bar -->
      <div class="sort-bar">
        <label data-i18n="members.filter.year">ì—°ë„:</label>
        <select id="alumni-year-filter" onchange="renderAlumni()" style="margin-right:20px">
          <option value="">ì „ì²´</option>
          <option value="2026">2026</option>
          <option value="2025">2025</option>
          <option value="2024">2024</option>
          <option value="2023">2023</option>
          <option value="2022">2022</option>
          <option value="2021">2021</option>
          <option value="2020">2020</option>
          <option value="2019">2019</option>
          <option value="2018">2018</option>
        </select>
        <label data-i18n="members.sort.label">ì •ë ¬:</label>
        <select id="alumni-sort" onchange="renderAlumni()">
          <option value="year-desc" data-i18n="members.sort.year-desc">ì—°ë„ (ìµœì‹ ìˆœ)</option>
          <option value="year-asc" data-i18n="members.sort.year-asc">ì—°ë„ (ì˜¤ë˜ëœìˆœ)</option>
          <option value="name-asc" data-i18n="members.sort.name-asc">ì´ë¦„ (ê°€ë‚˜ë‹¤ìˆœ)</option>
          <option value="workplace-asc" data-i18n="members.sort.workplace-asc">ì†Œì† (ê°€ë‚˜ë‹¤ìˆœ)</option>
        </select>
      </div>
      <div id="alumni-list">
        <div style="text-align:center;padding:60px;color:var(--text-muted)" data-i18n="common.loading">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>
      </div>
    </div>

    <!-- â”€â”€ Tab 4: 2026 TORCH Members â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div id="tab-current" class="tab-pane">
      <div class="sort-bar">
        <label data-i18n="members.sort.label">ì •ë ¬:</label>
        <select id="current-sort" onchange="renderCurrent()">
          <option value="order-asc" data-i18n="members.sort.order-asc">ê¸°ë³¸ ìˆœì„œ</option>
          <option value="name-asc" data-i18n="members.sort.name-asc">ì´ë¦„ (ê°€ë‚˜ë‹¤ìˆœ)</option>
          <option value="workplace-asc" data-i18n="members.sort.workplace-asc">ì†Œì† (ê°€ë‚˜ë‹¤ìˆœ)</option>
        </select>
      </div>
      <div id="current-list">
        <div style="text-align:center;padding:60px;color:var(--text-muted)" data-i18n="common.loading">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>
      </div>
    </div>

  </div>
</section>

<!-- â”€â”€ Artwork Lightbox â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="artwork-lightbox" onclick="closeLightbox()">
  <button id="lightbox-close" onclick="closeLightbox()" aria-label="ë‹«ê¸°">âœ•</button>
  <button id="lightbox-prev" class="lightbox-nav" onclick="event.stopPropagation();lightboxNav(-1)" aria-label="ì´ì „">â€¹</button>
  <img id="lightbox-img" src="" alt="Artwork">
  <button id="lightbox-next" class="lightbox-nav" onclick="event.stopPropagation();lightboxNav(1)" aria-label="ë‹¤ìŒ">â€º</button>
  <div id="lightbox-counter"></div>
</div>

<footer class="footer">
  <div class="container">
    <div class="footer-grid">
      <div class="footer-brand">
        <a href="../index.html" class="nav-logo"><div class="logo-icon">ğŸ”¥</div>TORCH</a>
        <p style="margin-top:12px" data-i18n-html="footer.brand.p">Korea Young Dental Technician Study<br>ê¸°ìˆ  Â· ê¸°íšŒ Â· ë³´ì™„ Â· ë„ì „ Â· í¬ë§</p>
        <div style="margin-top:16px"><a href="https://www.instagram.com/t_o_r_c_h_study/" target="_blank" class="btn btn-sm" style="background:rgba(255,255,255,.08);color:rgba(255,255,255,.7);border:1px solid rgba(255,255,255,.15)">ğŸ“· @t_o_r_c_h_study</a></div>
      </div>
      <div class="footer-col"><h4>Pages</h4><ul><li><a href="../about.html">About</a></li><li><a href="../activity/index.html">Activity</a></li><li><a href="../sponsor.html">Sponsor</a></li></ul></div>
      <div class="footer-col"><h4>Registration</h4><ul><li><a href="../registration/study.html">Study Group</a></li><li><a href="../registration/symposium.html">Symposium</a></li><li><a href="../registration/workshop.html">Workshop</a></li></ul></div>
      <div class="footer-col"><h4>Community</h4><ul><li><a href="../news/index.html">News</a></li><li><a href="members.html">Members</a></li><li><a href="../contact.html">Contact</a></li></ul></div>
    </div>
    <div class="footer-bottom">
      <span data-i18n="footer.copyright">Â© 2018 TORCH â€“ Korea Young Dental Technician Study. All rights reserved.</span>
      <div class="social-links">
        <a href="https://www.instagram.com/t_o_r_c_h_study/" target="_blank" class="social-link" title="Instagram">ğŸ“·</a>
      </div>
    </div>
  </div>
</footer>

<script src="../js/theme.js"></script>
<script>
/* â”€â”€ Tab switching â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let alumniLoaded = false, currentLoaded = false, pastPresidentsLoaded = false;

document.querySelectorAll('.tab-btn').forEach(btn => {
  btn.addEventListener('click', function() {
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
    this.classList.add('active');
    document.getElementById('tab-' + this.dataset.tab).classList.add('active');

    if (this.dataset.tab === 'past-presidents' && !pastPresidentsLoaded) {
      loadPastPresidents();
      pastPresidentsLoaded = true;
    }
    if (this.dataset.tab === 'alumni' && !alumniLoaded) {
      loadAllMembers();
      alumniLoaded = true;
    }
    if (this.dataset.tab === 'current' && !currentLoaded) {
      loadCurrentMembers();
      currentLoaded = true;
    }
  });
});

/* â”€â”€ Escape HTML â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function esc(str) {
  return (str || '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

/* â”€â”€ President â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function loadPresident() {
  try {
    const res = await fetch('/api/president');
    if (!res.ok) throw new Error();
    const p = await res.json();

    // Photo
    const photoEl = document.getElementById('president-photo');
    if (p.photo) {
      photoEl.innerHTML = `<img src="${esc(p.photo)}" alt="${esc(p.name)}" style="width:100%;height:100%;object-fit:cover;border-radius:50%">`;
    }

    // Name & title
    document.getElementById('president-name').textContent = p.name || 'â€”';
    document.getElementById('president-title-display').textContent = p.title || 'â€”';
    document.getElementById('president-sign').textContent = p.name || 'â€”';
    document.getElementById('president-title-sign').textContent = p.title || 'â€”';

    // Bio (greeting)
    const bioEl = document.getElementById('president-bio-display');
    if (p.bio) {
      bioEl.textContent = p.bio;
    } else {
      bioEl.innerHTML = `ì•ˆë…•í•˜ì„¸ìš”, TORCH íšŒì› ì—¬ëŸ¬ë¶„.<br><br>
ì €ëŠ” TORCHê°€ ë‹¨ìˆœí•œ ìŠ¤í„°ë”” ê·¸ë£¹ì´ ì•„ë‹ˆë¼, ëŒ€í•œë¯¼êµ­ ì¹˜ê³¼ê¸°ê³µ ì—…ê³„ì˜ ë¯¸ë˜ë¥¼ í•¨ê»˜ ë§Œë“¤ì–´ê°€ëŠ” ê³µë™ì²´ë¼ê³  ë¯¿ìŠµë‹ˆë‹¤.<br><br>
TORCHëŠ” <strong>T</strong>echnology(ê¸°ìˆ ), <strong>O</strong>pportunity(ê¸°íšŒ), <strong>R</strong>edeem(ë³´ì™„), <strong>C</strong>hallenge(ë„ì „), <strong>H</strong>ope(í¬ë§) â€” ì´ ë‹¤ì„¯ ê°€ì§€ ê°€ì¹˜ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ëª¨ì¸ ì Šì€ ì¹˜ê³¼ê¸°ê³µì‚¬ë“¤ì˜ ëª¨ì„ì…ë‹ˆë‹¤.<br><br>
ì—¬ëŸ¬ë¶„ì˜ ì°¸ì—¬ì™€ ì—´ì •ì´ TORCHë¥¼ ë”ìš± ë¹›ë‚˜ê²Œ í•©ë‹ˆë‹¤. í•¨ê»˜í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.`;
    }
  } catch {
    // keep default fallback text
  }
}

/* â”€â”€ Past Presidents (ì—­ëŒ€ íšŒì¥) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function loadPastPresidents() {
  const container = document.getElementById('past-presidents-list');
  try {
    const res = await fetch('/api/past-presidents');
    if (!res.ok) throw new Error();
    const { presidents } = await res.json();

    if (!presidents || !presidents.length) {
      container.innerHTML = `<div style="text-align:center;padding:60px;color:var(--text-muted);grid-column:1/-1">
        <div style="font-size:3rem;margin-bottom:16px">ğŸ‘‘</div>
        <p>ì—­ëŒ€ íšŒì¥ ì •ë³´ë¥¼ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.</p>
      </div>`;
      return;
    }

    container.innerHTML = presidents.map(p => {
      const initial = (p.name || '?').replace(/\s/g, '')[0] || '?';
      const avatar = p.photo
        ? `<img src="${esc(p.photo)}" alt="${esc(p.name)}" style="width:100%;height:100%;object-fit:cover">`
        : initial;

      const period = p.year_start && p.year_end
        ? `${p.year_start} - ${p.year_end}`
        : '';

      return `
        <div class="card" style="text-align:center;padding:28px">
          <div style="width:120px;height:120px;border-radius:50%;overflow:hidden;background:var(--primary);display:flex;align-items:center;justify-content:center;font-size:3rem;font-weight:700;color:#fff;margin:0 auto 16px;border:3px solid var(--primary)">
            ${avatar}
          </div>
          <div style="font-size:1.3rem;font-weight:700;color:var(--primary);margin-bottom:4px">${esc(p.term || 'ì œ' + p.order_num + 'ëŒ€')}</div>
          <h3 style="font-size:1.1rem;margin-bottom:6px">${esc(p.name)}</h3>
          <p style="font-size:.88rem;color:var(--text-muted);margin-bottom:8px">${esc(p.title)}</p>
          ${period ? `<p style="font-size:.82rem;color:var(--text-muted)">${esc(period)}</p>` : ''}
        </div>
      `;
    }).join('');
  } catch {
    container.innerHTML = `<div style="text-align:center;padding:60px;color:var(--text-muted);grid-column:1/-1">
      <div style="font-size:3rem;margin-bottom:16px">ğŸ‘‘</div>
      <p>ì—­ëŒ€ íšŒì¥ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
    </div>`;
  }
}

/* â”€â”€ All members (ì—­ëŒ€ â€“ includes 2026 current) â”€â”€ */
let allMembersData = [];

async function loadAllMembers() {
  const container = document.getElementById('alumni-list');
  try {
    const res = await fetch('/api/members-list');  // no category filter â†’ all members
    if (!res.ok) throw new Error();
    const { members } = await res.json();
    allMembersData = members || [];
    renderAlumni();
  } catch {
    container.innerHTML = `<div style="text-align:center;padding:60px;color:var(--text-muted)">
      <div style="font-size:3rem;margin-bottom:16px">ğŸ“š</div>
      <p>ì—­ëŒ€ íšŒì› ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
    </div>`;
  }
}

function renderAlumni() {
  const container = document.getElementById('alumni-list');
  if (!allMembersData.length) {
    container.innerHTML = `<div style="text-align:center;padding:60px;color:var(--text-muted)">
      <div style="font-size:3rem;margin-bottom:16px">ğŸ“š</div><p>ë“±ë¡ëœ íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤.</p></div>`;
    return;
  }

  const yearFilter = document.getElementById('alumni-year-filter').value;
  const sortKey = document.getElementById('alumni-sort').value;
  let sorted = [...allMembersData];

  // Apply year filter
  if (yearFilter) {
    sorted = sorted.filter(m => {
      const yearStr = m.year || '';
      const years = yearStr.toString().split(',').map(y => y.trim());
      return years.includes(yearFilter);
    });
  }

  if (sortKey === 'year-desc') {
    sorted.sort((a, b) => (b.year || 0) - (a.year || 0) || (a.order_num || 0) - (b.order_num || 0));
  } else if (sortKey === 'year-asc') {
    sorted.sort((a, b) => (a.year || 0) - (b.year || 0) || (a.order_num || 0) - (b.order_num || 0));
  } else if (sortKey === 'name-asc') {
    sorted.sort((a, b) => (a.name || '').localeCompare(b.name || '', 'ko'));
  } else if (sortKey === 'workplace-asc') {
    sorted.sort((a, b) => (a.workplace || '').localeCompare(b.workplace || '', 'ko'));
  }

  if (!sorted.length) {
    container.innerHTML = `<div style="text-align:center;padding:60px;color:var(--text-muted)">
      <div style="font-size:3rem;margin-bottom:16px">ğŸ“š</div>
      <p>${yearFilter}ë…„ íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤.</p>
    </div>`;
    return;
  }

  // If year filter is selected, show only that year group
  if (yearFilter) {
    container.innerHTML = `
      <div class="year-group">
        <div class="year-label">${esc(yearFilter)} Members</div>
        ${sorted.map(m => buildMemberCard(m)).join('')}
      </div>
    `;
    return;
  }

  // Group by year (supporting comma-separated years like "2023, 2024")
  const byYear = {};
  sorted.forEach(m => {
    const yearStr = m.year || 'ê¸°íƒ€';
    // Split by comma and trim whitespace to support multiple years
    const years = yearStr.toString().split(',').map(y => y.trim());

    years.forEach(y => {
      if (!byYear[y]) byYear[y] = [];
      byYear[y].push(m);
    });
  });

  // Year order depends on sort
  let years = Object.keys(byYear);
  if (sortKey === 'year-asc') {
    years.sort((a, b) => Number(a) - Number(b));
  } else if (sortKey === 'year-desc') {
    years.sort((a, b) => Number(b) - Number(a));
  }
  // For name/workplace sort, keep insertion order (already sorted above)

  container.innerHTML = years.map(y => `
    <div class="year-group">
      <div class="year-label">${esc(y)} Members</div>
      ${byYear[y].map(m => buildMemberCard(m)).join('')}
    </div>
  `).join('');
}

/* â”€â”€ 2026 current members â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let currentMembersData = [];

async function loadCurrentMembers() {
  const container = document.getElementById('current-list');
  try {
    const res = await fetch('/api/members-list?category=current');
    if (!res.ok) throw new Error();
    const { members } = await res.json();

    if (!members || !members.length) {
      container.innerHTML = `<div style="text-align:center;padding:60px;color:var(--text-muted)">
        <div style="font-size:3rem;margin-bottom:16px">ğŸ‘¥</div>
        <p>2026 íšŒì› ì†Œê°œë¥¼ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.</p>
        <p style="font-size:.88rem">ë¬¸ì˜: <a href="../contact.html">contact í˜ì´ì§€</a> ë˜ëŠ” <a href="https://www.instagram.com/t_o_r_c_h_study/" target="_blank">Instagram</a></p>
      </div>`;
      return;
    }
    currentMembersData = members;
    renderCurrent();
  } catch(e) {
    container.innerHTML = `<div style="text-align:center;padding:60px;color:var(--text-muted)">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>`;
  }
}

function renderCurrent() {
  const container = document.getElementById('current-list');
  if (!currentMembersData.length) return;

  const sortKey = document.getElementById('current-sort').value;
  let sorted = [...currentMembersData];

  if (sortKey === 'name-asc') {
    sorted.sort((a, b) => (a.name || '').localeCompare(b.name || '', 'ko'));
  } else if (sortKey === 'workplace-asc') {
    sorted.sort((a, b) => (a.workplace || '').localeCompare(b.workplace || '', 'ko'));
  } else {
    sorted.sort((a, b) => (a.order_num || 0) - (b.order_num || 0));
  }

  container.innerHTML = sorted.map(m => buildMemberCard(m)).join('');
}

/* â”€â”€ Build member card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const _artworkStore = {};
let _cardIdx = 0;

function parseArtworks(raw) {
  if (!raw) return [];
  try {
    const parsed = JSON.parse(raw);
    return Array.isArray(parsed) ? parsed : [raw];
  } catch { return [raw]; }
}

function buildMemberCard(m) {
  const initial = (m.name || '?').replace(/\s/g, '')[0] || '?';
  const avatar = m.photo
    ? `<img src="${esc(m.photo)}" alt="${esc(m.name)}">`
    : initial;

  const webpage = m.webpage
    ? `<div style="margin-top:14px"><a href="${esc(m.webpage)}" target="_blank" rel="noopener" class="btn btn-sm btn-dark" style="font-size:.78rem;padding:5px 12px" onclick="event.stopPropagation()">ğŸŒ ì›¹ì‚¬ì´íŠ¸</a></div>`
    : '';

  const artworks = parseArtworks(m.artwork);
  let cardAttrs = 'class="member-row-card"';
  let artworkHint = '';
  if (artworks.length > 0) {
    const idx = _cardIdx++;
    _artworkStore[idx] = m.artwork; // raw string (single b64 or JSON array)
    cardAttrs = `class="member-row-card has-artwork" onclick="openLightbox(_artworkStore[${idx}])"`;
    artworkHint = `<div class="artwork-hint">ğŸ–¼ Artwork${artworks.length > 1 ? ' ' + artworks.length + 'ì¥' : ''} ë³´ê¸°</div>`;
  }

  return `
    <div ${cardAttrs}>
      <div class="member-avatar-lg">${avatar}</div>
      <div class="member-card-info">
        <div class="member-info-name">${esc(m.name)}</div>
        ${m.title    ? `<div class="member-info-title">${esc(m.title)}</div>` : ''}
        ${m.workplace? `<div class="member-info-workplace">ğŸ“ ${esc(m.workplace)}</div>` : ''}
        ${m.bio      ? `<div class="member-info-bio">${esc(m.bio)}</div>` : ''}
        ${artworkHint}
        ${webpage}
      </div>
    </div>`;
}

/* â”€â”€ Lightbox (carousel) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let _lightboxImages = [];
let _lightboxIdx = 0;

function openLightbox(artworkRaw) {
  _lightboxImages = parseArtworks(artworkRaw);
  _lightboxIdx = 0;
  _renderLightbox();
  document.getElementById('artwork-lightbox').classList.add('open');
  document.body.style.overflow = 'hidden';
}

function _renderLightbox() {
  document.getElementById('lightbox-img').src = _lightboxImages[_lightboxIdx] || '';
  const multi = _lightboxImages.length > 1;
  const prev = document.getElementById('lightbox-prev');
  const next = document.getElementById('lightbox-next');
  const counter = document.getElementById('lightbox-counter');
  prev.style.display = multi && _lightboxIdx > 0 ? 'flex' : 'none';
  next.style.display = multi && _lightboxIdx < _lightboxImages.length - 1 ? 'flex' : 'none';
  if (multi) {
    counter.textContent = `${_lightboxIdx + 1} / ${_lightboxImages.length}`;
    counter.style.display = 'block';
  } else {
    counter.style.display = 'none';
  }
}

function lightboxNav(dir) {
  _lightboxIdx = Math.max(0, Math.min(_lightboxImages.length - 1, _lightboxIdx + dir));
  _renderLightbox();
}

function closeLightbox() {
  document.getElementById('artwork-lightbox').classList.remove('open');
  document.getElementById('lightbox-img').src = '';
  _lightboxImages = [];
  document.body.style.overflow = '';
}

document.addEventListener('keydown', e => {
  if (!document.getElementById('artwork-lightbox').classList.contains('open')) return;
  if (e.key === 'Escape') closeLightbox();
  if (e.key === 'ArrowLeft')  lightboxNav(-1);
  if (e.key === 'ArrowRight') lightboxNav(1);
});

/* â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
loadPresident();
</script>
<script src="../js/theme.js"></script>
<script src="../js/i18n.js"></script>
<script src="../js/menu.js"></script>
</body>
</html>
