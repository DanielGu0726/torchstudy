<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>News â€“ TORCH</title>
  <link rel="stylesheet" href="../css/style.css">
</head>
<body>
<nav class="navbar">
  <div class="nav-inner">
    <a href="../index.html" class="nav-logo"><div class="logo-icon">ğŸ”¥</div>TORCH</a>
    <div class="nav-links">
      <div class="nav-item"><a href="../index.html" class="nav-link">Home</a></div>
      <div class="nav-item"><a href="../about.html" class="nav-link">About</a></div>
      <div class="nav-item"><a href="../activity/index.html" class="nav-link">Activity</a></div>
      <div class="nav-item"><span class="nav-link">Registration <svg viewBox="0 0 10 6" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M1 1l4 4 4-4"/></svg></span><div class="dropdown"><a href="../registration/study.html">Study Group</a><a href="../registration/symposium.html">Symposium</a><a href="../registration/workshop.html">Workshop</a></div></div>
      <div class="nav-item"><a href="../sponsor.html" class="nav-link">Sponsor</a></div>
      <div class="nav-item"><a href="../members/members.html" class="nav-link">Members</a></div>
      <div class="nav-item"><a href="index.html" class="nav-link active">News</a></div>
      <div class="nav-item"><a href="../contact.html" class="nav-link">Contact</a></div>
    </div>
    <div class="lang-toggle">
      <button class="lang-btn active" id="btn-ko" onclick="I18n.setLang('ko')">KOR</button>
      <button class="lang-btn" id="btn-en" onclick="I18n.setLang('en')">ENG</button>
    </div>
    <div class="hamburger"><span></span><span></span><span></span></div>
  </div>
</nav>
<div class="mobile-menu">
  <a href="../index.html" class="mobile-link">Home</a>
  <a href="../about.html" class="mobile-link">About</a>
  <a href="../activity/index.html" class="mobile-link">Activity</a>
  <div class="mobile-dropdown">
    <div class="mobile-dropdown-toggle">
      <span>Registration</span>
      <svg viewBox="0 0 10 6" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M1 1l4 4 4-4"/></svg>
    </div>
    <div class="mobile-submenu">
      <a href="../registration/study.html" class="mobile-link" data-i18n="mobile.study">Study ì‹ ì²­</a>
      <a href="../registration/symposium.html" class="mobile-link">Symposium</a>
      <a href="../registration/workshop.html" class="mobile-link" data-i18n="mobile.workshop">Workshop ì‹ ì²­</a>
    </div>
  </div>
  <a href="../sponsor.html" class="mobile-link">Sponsor</a>
  <a href="../members/members.html" class="mobile-link" data-i18n="mobile.members">Members ì†Œê°œ</a>
  <a href="index.html" class="mobile-link">News</a>
  <a href="../contact.html" class="mobile-link">Contact</a>

  <!-- Mobile Toggles -->
  <div class="mobile-toggles">
    <div class="mobile-toggle-row">
      <span class="mobile-toggle-label">Dark Mode</span>
      <div class="mobile-theme-toggle" onclick="Theme.toggle()">
        <span class="toggle-knob"></span>
      </div>
    </div>
    <div class="mobile-toggle-row">
      <span class="mobile-toggle-label">Language</span>
      <div class="mobile-lang-toggle">
        <button class="mobile-lang-btn active" id="mobile-btn-ko" onclick="I18n.setLang('ko')">KOR</button>
        <button class="mobile-lang-btn" id="mobile-btn-en" onclick="I18n.setLang('en')">ENG</button>
      </div>
    </div>
  </div>
</div>

<div class="page-header">
  <div class="container">
    <span class="eyebrow">Latest Updates</span>
    <h1 data-i18n="news.header.h1">News & ê³µì§€ì‚¬í•­</h1>
    <p data-i18n="news.header.p">TORCHì˜ ìµœì‹  ì†Œì‹, í–‰ì‚¬ ê³µì§€, íšŒì› í™œë™ ì†Œì‹ì„ í™•ì¸í•˜ì„¸ìš”.</p>
    <div class="breadcrumb"><a href="../index.html">Home</a><span>/</span><span>News</span></div>
  </div>
</div>

<section class="section section-light">
  <div class="container">
    <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:32px" id="filter-bar">
      <button class="btn btn-primary btn-sm filter-btn active" data-filter="all" data-i18n="news.filter.all">ì „ì²´</button>
      <button class="btn btn-dark btn-sm filter-btn" data-filter="ê³µì§€" data-i18n="news.filter.notice">ê³µì§€</button>
      <button class="btn btn-dark btn-sm filter-btn" data-filter="í–‰ì‚¬" data-i18n="news.filter.event">í–‰ì‚¬</button>
      <button class="btn btn-dark btn-sm filter-btn" data-filter="ì›Œí¬ìƒµ" data-i18n="news.filter.workshop">ì›Œí¬ìƒµ</button>
      <button class="btn btn-dark btn-sm filter-btn" data-filter="ì†Œì‹" data-i18n="news.filter.news">ì†Œì‹</button>
    </div>

    <div id="news-list" class="news-list">
      <div style="text-align:center;padding:60px;color:var(--text-muted)" data-i18n="common.loading">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>
    </div>
  </div>
</section>

<!-- News Detail Modal -->
<div id="news-modal" class="news-modal">
  <div class="news-modal-content">
    <button class="news-modal-close" onclick="closeNewsModal()">Ã—</button>
    <div class="news-modal-header">
      <div class="news-meta" id="modal-meta"></div>
      <h2 id="modal-title" style="margin-top:12px"></h2>
    </div>
    <div class="news-modal-body" id="modal-body"></div>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <div class="footer-grid">
      <div class="footer-brand"><a href="../index.html" class="nav-logo"><div class="logo-icon">ğŸ”¥</div>TORCH</a><p style="margin-top:12px" data-i18n-html="footer.brand.p">Korea Young Dental Technician Study<br>ê¸°ìˆ  Â· ê¸°íšŒ Â· ë³´ì™„ Â· ë„ì „ Â· í¬ë§</p></div>
      <div class="footer-col"><h4>Pages</h4><ul><li><a href="../about.html">About</a></li><li><a href="../activity/index.html">Activity</a></li><li><a href="../sponsor.html">Sponsor</a></li></ul></div>
      <div class="footer-col"><h4>Registration</h4><ul><li><a href="../registration/study.html">Study Group</a></li><li><a href="../registration/symposium.html">Symposium</a></li><li><a href="../registration/workshop.html">Workshop</a></li></ul></div>
      <div class="footer-col"><h4>Community</h4><ul><li><a href="index.html">News</a></li><li><a href="../contact.html">Contact</a></li></ul></div>
    </div>
    <div class="footer-bottom"><span data-i18n="footer.copyright">Â© 2018 TORCH â€“ Korea Young Dental Technician Study. All rights reserved.</span></div>
  </div>
</footer>

<script src="../js/theme.js"></script>
<script>
let allNews = [];
let currentFilter = 'all';

/* Filter buttons */
document.querySelectorAll('.filter-btn').forEach(btn => {
  btn.addEventListener('click', function() {
    document.querySelectorAll('.filter-btn').forEach(b => {
      b.className = 'btn btn-dark btn-sm filter-btn';
    });
    this.className = 'btn btn-primary btn-sm filter-btn active';
    currentFilter = this.dataset.filter;
    renderNews();
  });
});

function renderNews() {
  const list = document.getElementById('news-list');
  const filtered = currentFilter === 'all'
    ? allNews
    : allNews.filter(n => n.category === currentFilter);

  if (!filtered.length) {
    list.innerHTML = `<div style="text-align:center;padding:60px;color:var(--text-muted)">
      <div style="font-size:3rem;margin-bottom:16px">ğŸ“­</div>
      <p>ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
    </div>`;
    return;
  }

  const catIcon = { 'ê³µì§€': 'ğŸ“¢', 'í–‰ì‚¬': 'ğŸ¤', 'ì›Œí¬ìƒµ': 'ğŸ› ï¸', 'ì†Œì‹': 'ğŸ“¸' };
  list.innerHTML = filtered.map((n) => `
    <div class="news-item" data-news-id="${n.id}">
      <div class="news-icon">${catIcon[n.category] || 'ğŸ“Œ'}</div>
      <div class="news-content">
        <div class="news-meta">
          <span class="news-tag">${esc(n.category)}</span>
          <span class="news-date">${formatDate(n.created_at)}</span>
        </div>
        <h3>${esc(n.title)}</h3>
        <p>${truncate(n.content, 100)}</p>
      </div>
      <div class="news-arrow">â†’</div>
    </div>
  `).join('');

  // Add click event listeners
  document.querySelectorAll('.news-item').forEach(item => {
    item.addEventListener('click', function() {
      const newsId = parseInt(this.dataset.newsId);
      openNewsModal(newsId);
    });
  });
}

function openNewsModal(newsId) {
  const news = allNews.find(n => n.id === newsId);
  if (!news) return;

  const catIcon = { 'ê³µì§€': 'ğŸ“¢', 'í–‰ì‚¬': 'ğŸ¤', 'ì›Œí¬ìƒµ': 'ğŸ› ï¸', 'ì†Œì‹': 'ğŸ“¸' };
  document.getElementById('modal-meta').innerHTML = `
    <span class="news-tag">${esc(news.category)}</span>
    <span class="news-date">${formatDate(news.created_at)}</span>
  `;
  document.getElementById('modal-title').textContent = news.title;

  // Build modal body with image and content
  let bodyHTML = '';
  if (news.image) {
    bodyHTML += `<img src="${esc(news.image)}" alt="${esc(news.title)}" style="width:100%;border-radius:8px;margin-bottom:20px">`;
  }
  bodyHTML += `<p style="white-space:pre-wrap;line-height:1.8">${esc(news.content)}</p>`;

  document.getElementById('modal-body').innerHTML = bodyHTML;

  const modal = document.getElementById('news-modal');
  modal.classList.add('open');
  document.body.style.overflow = 'hidden';
}

function closeNewsModal() {
  const modal = document.getElementById('news-modal');
  modal.classList.remove('open');
  document.body.style.overflow = '';
}

// Close modal on outside click
document.getElementById('news-modal').addEventListener('click', function(e) {
  if (e.target === this) closeNewsModal();
});

// Close modal on ESC key
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape' && document.getElementById('news-modal').classList.contains('open')) {
    closeNewsModal();
  }
});

function formatDate(iso) {
  if (!iso) return '';
  const d = new Date(iso);
  return `${d.getFullYear()}ë…„ ${d.getMonth()+1}ì›” ${d.getDate()}ì¼`;
}

function truncate(str, len) {
  if (!str) return '';
  return str.length > len ? str.substring(0, len) + '...' : str;
}

function esc(str) {
  return (str || '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

/* Load news from API */
(async () => {
  try {
    const res = await fetch('/api/news');
    if (!res.ok) throw new Error();
    const { news } = await res.json();
    allNews = news || [];
    renderNews();
  } catch {
    document.getElementById('news-list').innerHTML = `
      <div style="text-align:center;padding:60px;color:var(--text-muted)">
        <p>ê³µì§€ì‚¬í•­ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
        <p style="font-size:.85rem;margin-top:8px">Instagramì—ì„œ ìµœì‹  ì†Œì‹ì„ í™•ì¸í•˜ì„¸ìš”.</p>
        <a href="https://www.instagram.com/t_o_r_c_h_study/" target="_blank" class="btn btn-primary" style="margin-top:16px">ğŸ“· @t_o_r_c_h_study</a>
      </div>`;
  }
})();
</script>
<script src="../js/theme.js"></script>
<script src="../js/i18n.js"></script>
<script src="../js/menu.js"></script>
</body>
</html>
